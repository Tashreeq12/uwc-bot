<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>UWC Bot (Mobile-Friendly, Voice Enabled)</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }

  /* UWC Bot Button */
  #openBot {
    margin: 20px 0 10px 0;
    padding: 12px 20px;
    font-size: 18px;
    background: #3276EA;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  /* Voice Controls */
  #voiceControls {
    display: none;
    flex-direction: row;
    gap: 8px;
    margin-bottom: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  #voiceBtn, #stopBtn {
    border:0;
    padding:10px 14px;
    border-radius:8px;
    cursor:pointer;
    font-size:16px;
  }
  #voiceBtn { background:#1e88e5; color:#fff; }
  #voiceBtn:disabled { background:#9e9e9e; cursor:not-allowed; }
  #stopBtn { background:#f5f5f5; }

  /* Status text */
  #status {
    font-size:14px;
    color:#555;
    text-align: center;
    width: 100%;
    max-width: 500px;
  }

  /* Chat container */
  #webchat {
    width: 100%;
    max-width: 500px;
    height: 60vh;
    margin-bottom: 20px;
  }

  /* Hide Botpress floating button */
  .bpw-floating-button { display:none !important; }

  /* Make chat responsive */
  @media (max-width: 600px){
    #webchat { height: 70vh; }
    #openBot { width: 90%; }
  }
</style>

<!-- Botpress Webchat -->
<script src="https://cdn.botpress.cloud/webchat/v3.2/inject.js"></script>

<body>

<!-- UWC Bot Button -->
<button id="openBot">UWC Bot</button>

<!-- Voice Controls -->
<div id="voiceControls">
  <button id="voiceBtn">üé§ Speak</button>
  <button id="stopBtn">‚èπ Stop Voice</button>
</div>

<!-- Status -->
<div id="status"></div>

<!-- Chat Container -->
<div id="webchat"></div>

<script>
  // Initialize Botpress
  window.botpress.init({
    botId: 'aa441515-3c65-48ea-acd1-91044111bed2',
    clientId: '4122d265-45f6-47ff-ad06-007367e5444b',
    selector: '#webchat',
    configuration: {
      enableTextInput: true,
      showConversationsButton: false,
      themeMode: 'light',
      fontFamily: 'Inter, Arial',
      radius: 4,
      headerVariant: 'glass',
      color: '#3276EA',
      footer: "[‚ö° by Botpress](https://botpress.com/?from=webchat)"
    }
  });

  // Wait until Botpress is ready
  (function ready(cb){
    if(window.botpressWebChat){ cb(); } 
    else { setTimeout(() => ready(cb), 100); }
  })(function(){
    const openBotBtn = document.getElementById('openBot');
    const voiceControls = document.getElementById('voiceControls');
    const voiceBtn = document.getElementById('voiceBtn');
    const stopBtn = document.getElementById('stopBtn');
    const statusEl = document.getElementById('status');

    // Text-to-Speech
    function speak(text){
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang='en-US'; 
      u.rate=1.0;
      window.speechSynthesis.speak(u);
    }

    // Listen for bot messages
    window.botpressWebChat.onEvent('incoming.message', (event)=>{
      if(event.payload && event.payload.text){
        speak(event.payload.text);
      }
    });

    // Speech recognition
    const Rec = window.SpeechRecognition || window.webkitSpeechRecognition;
    let rec, listening = false;
    if(Rec){
      rec = new Rec();
      rec.lang = 'en-US';
      rec.interimResults = false;

      rec.onresult = (e)=>{
        const said = e.results[0][0].transcript;
        statusEl.textContent = `You said: ${said}`;
        window.botpressWebChat.sendEvent({ type:'input.text', text: said });
      };
      rec.onerror = ()=>{
        statusEl.textContent='Mic error. Try again.';
        listening = false;
        voiceBtn.disabled = false;
      };
      rec.onend = ()=>{
        listening = false;
        voiceBtn.disabled = false;
        statusEl.textContent='You can type below or use voice üé§';
      };

      voiceBtn.addEventListener('click', ()=>{
        window.speechSynthesis.cancel();
        statusEl.textContent='Listening‚Ä¶ (allow mic if asked)';
        voiceBtn.disabled = true;
        listening = true;
        rec.start();
      });
      stopBtn.addEventListener('click', ()=>window.speechSynthesis.cancel());
    } else {
      statusEl.textContent='Voice input not supported. Please use Chrome.';
      voiceBtn.disabled = true;
    }

    // Open bot when UWC Bot button clicked
    openBotBtn.addEventListener('click', ()=>{
      if(window.botpressWebChat) window.botpressWebChat.open();
      voiceControls.style.display = 'flex';
      statusEl.textContent='You can type below or use voice üé§';
    });
  });
</script>

</body>
</html>






